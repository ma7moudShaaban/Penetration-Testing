# Windows Privilege Escalation
- [Situational Awareness](#situational-awareness)
- [Initial Enumeration](#initial-enumeration)
    - [System Information](#system-information)
    - [User & Group Information](#user--group-information)







## Situational Awareness
- **Network Information**
```bat
# Interface(s), IP Address(es), DNS Information
C:\htb> ipconfig /all

# ARP Table
C:\htb> arp -a

# Routing Table
C:\htb> route print

```

- **Enumerating Protections**
```powershell
# Check Windows Defender Status
PS C:\htb> Get-MpComputerStatus

# List AppLocker Rules
PS C:\htb> Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections

# Test AppLocker Policy
PS C:\htb> Get-AppLockerPolicy -Local | Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone

FilePath                    PolicyDecision MatchingRule
--------                    -------------- ------------
C:\Windows\System32\cmd.exe         Denied c:\windows\system32\cmd.exe


```
## Initial Enumeration
### System Information
```bat
# Tasklist
C:\htb> tasklist /svc

# Display All Environment Variables
C:\htb> set

# View Detailed Configuration Information
C:\htb> systeminfo

```
- **Patches and Updates**
    - If systeminfo doesn't display hotfixes, they may be queriable with WMI using the WMI-Command binary with QFE (Quick Fix Engineering) to display patches.

```bat
C:\htb> wmic qfe

Caption                                     CSName        Description      FixComments  HotFixID   InstallDate  InstalledBy          InstalledOn  Name  ServicePackInEffect  Status
http://support.microsoft.com/?kbid=3199986  WINLPE-SRV01  Update                        KB3199986               NT AUTHORITY\SYSTEM  11/21/2016
https://support.microsoft.com/help/5001078  WINLPE-SRV01  Security Update               KB5001078               NT AUTHORITY\SYSTEM  3/25/2021
http://support.microsoft.com/?kbid=4103723  WINLPE-SRV01  Security Update               KB4103723               NT AUTHORITY\SYSTEM  3/25/2021
```
```powershell
PS C:\htb> Get-HotFix | ft -AutoSize

Source       Description     HotFixID  InstalledBy                InstalledOn
------       -----------     --------  -----------                -----------
WINLPE-SRV01 Update          KB3199986 NT AUTHORITY\SYSTEM        11/21/2016 12:00:00 AM
WINLPE-SRV01 Update          KB4054590 WINLPE-SRV01\Administrator 3/30/2021 12:00:00 AM
WINLPE-SRV01 Security Update KB5001078 NT AUTHORITY\SYSTEM        3/25/2021 12:00:00 AM
WINLPE-SRV01 Security Update KB3200970 WINLPE-SRV01\Administrator 4/13/2021 12:00:00 AM
```

- **Installed programs**

```bat
C:\htb> wmic product get name
```
```powershell
PS C:\htb> Get-WmiObject -Class Win32_Product |  select Name, Version
```

- **Display Running Processes**
```bat
# Netstat
PS C:\htb> netstat -ano
```

### User & Group Information

```bat
# Logged-In Users
C:\htb> query user

 USERNAME              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME
>administrator         rdp-tcp#2           1  Active          .  3/25/2021 9:27 AM

# Current User
C:\htb> echo %USERNAME%

htb-student 

# Current User Privileges
C:\htb> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled

# Current User Group Information
C:\htb> whoami /groups

# Get All Users
C:\htb> net user

# Get All Groups
C:\htb> net localgroup

# Details About a Group
C:\htb> net localgroup administrators

# Get Password Policy & Other Account Information
C:\htb> net accounts


```



# Resources
- Pre-compiled binaries of Seatbelt and SharpUp [here](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries)
- [Hacktricks](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation) 
- [LOLBAS](https://lolbas-project.github.io/)
